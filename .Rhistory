plot(j_names,
s_j[1,i,!is.nan(s_j[1,i,])], ylim=c(0,max(s_j[1,i,!is.nan(s_j[1,i,])],
plogis(sd_yj[1,i,!is.nan(s_j[1,i,])]),
s_j[2,i,!is.nan(s_j[2,i,])],
plogis(sd_yj[2,i,!is.nan(s_j[2,i,])]))),
pch=16)
lines(j_names,
plogis(sd_yj[1,i,!is.nan(s_j[1,i,])]))
lines(j_names,
plogis(sd_yj_u[1,i,!is.nan(s_j[1,i,])]), lty=2)
lines(j_names,
plogis(sd_yj_l[1,i,!is.nan(s_j[1,i,])]), lty=2)
points(j_names,
s_j[2,i,!is.nan(s_j[2,i,])], col="red", pch=16)
lines(j_names,
plogis(sd_yj[2,i,!is.nan(s_j[2,i,])]), col="red")
lines(j_names,
plogis(sd_yj_u[2,i,!is.nan(s_j[2,i,])]), lty=2, col="red")
lines(j_names,
plogis(sd_yj_l[2,i,!is.nan(s_j[2,i,])]), lty=2, col="red")
}
plot(l_names[!is.nan(s_l[1,i,])],
s_l[1,i,!is.nan(s_l[1,i,])], ylim=c(0,max(s_l[1,i,!is.nan(s_l[1,i,])],
plogis(sd_yl[1,i,!is.nan(s_l[1,i,])]),
s_l[2,i,!is.nan(s_l[2,i,])],
plogis(sd_yl[2,i,!is.nan(s_l[2,i,])]))),
pch=16)
lines(l_names,
plogis(sd_yl[1,i,!is.nan(s_l[1,i,])]))
lines(l_names,
plogis(sd_yl_u[1,i,!is.nan(s_l[1,i,])]), lty=2)
lines(l_names,
plogis(sd_yl_l[1,i,!is.nan(s_l[1,i,])]), lty=2)
points(l_names,
s_l[2,i,!is.nan(s_l[2,i,])], col="red", pch=16)
lines(l_names,
plogis(sd_yl[2,i,!is.nan(s_l[2,i,])]), col="red")
lines(l_names,
plogis(sd_yl_u[2,i,!is.nan(s_l[2,i,])]), lty=2, col="red")
lines(l_names,
plogis(sd_yl_l[2,i,!is.nan(s_l[2,i,])]), lty=2, col="red")
plot(j_names,
s_j[1,i,!is.nan(s_j[1,i,])], ylim=c(0,max(s_j[1,i,!is.nan(s_j[1,i,])],
plogis(sd_yj[1,i,!is.nan(s_j[1,i,])]),
s_j[2,i,!is.nan(s_j[2,i,])],
plogis(sd_yj[2,i,!is.nan(s_j[2,i,])]))),
pch=16)
lines(j_names,
plogis(sd_yj[1,i,!is.nan(s_j[1,i,])]))
lines(j_names,
plogis(sd_yj_u[1,i,!is.nan(s_j[1,i,])]), lty=2)
lines(j_names,
plogis(sd_yj_l[1,i,!is.nan(s_j[1,i,])]), lty=2)
points(j_names,
s_j[2,i,!is.nan(s_j[2,i,])], col="red", pch=16)
j_names
points(j_names[!is.nan(s_j[2,i,])]],
s_j[2,i,!is.nan(s_j[2,i,])], col="red", pch=16)
points(j_names[!is.nan(s_j[2,i,])],
s_j[2,i,!is.nan(s_j[2,i,])], col="red", pch=16)
lines(j_names[!is.nan(s_j[2,i,])],
plogis(sd_yj[2,i,!is.nan(s_j[2,i,])]), col="red")
lines(j_names[!is.nan(s_j[2,i,])],
plogis(sd_yj_u[2,i,!is.nan(s_j[2,i,])]), lty=2, col="red")
lines(j_names[!is.nan(s_j[2,i,])],
plogis(sd_yj_l[2,i,!is.nan(s_j[2,i,])]), lty=2, col="red")
table(names(opt$SD$value))
y <- opt$SD$value[names(opt$SD$value)=="sd_y"]
matplot(plogis(y))
matplot(t(plogis(y)))
y <- array(opt$SD$value[names(opt$SD$value)=="sd_y"],c(2,ny))
matplot(t(plogis(y)))
matplot((plogis(y)))
y
ny
y <- array(opt$SD$value[names(opt$SD$value)=="sd_y"],c(2,ny))
y
opt$SD$value[names(opt$SD$value)=="sd_y"]
table(data$y_i)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
y <- array(opt$SD$value[names(opt$SD$value)=="sd_y"],c(2,ny))
y
matplot(t(y))
matplot(t(plogis(y)))
nj
j <- array(opt$SD$value[names(opt$SD$value)=="sd_j"],c(2,nj))
l <- array(opt$SD$value[names(opt$SD$value)=="sd_l"],c(2,nl))
l_u <- array(l+1.96*opt$SD$sd[names(opt$SD$value)=="sd_l"],c(2,nl))
l_l <- array(l-1.96*opt$SD$sd[names(opt$SD$value)=="sd_l"],c(2,nl))
plot(l)
lines(l_u, lty=2)
lines(l_l, lty=2)
l
y <- array(opt$SD$value[names(opt$SD$value)=="sd_y"],c(2,ny))
y_u <- array(y+1.96*opt$SD$sd[names(opt$SD$value)=="sd_y"],c(2,ny))
y_l <- array(y-1.96*opt$SD$sd[names(opt$SD$value)=="sd_y"],c(2,ny))
plot(y)
matplot(y)
matplot(t(y))
matplot(t(y), type="l")
matplot(t(y), type="l", lty=1)
matlines(y_u, lty=2)
matlines(y_l, lty=2)
matplot(t(y), type="l", lty=1)
matlines(t(y_u), lty=2)
matlines(t(y_l), lty=2)
t(y_u)
matlines((y_u), lty=2)
matplot(plogis(t(y)), type="l", lty=1)
y <- plogis(array(opt$SD$value[names(opt$SD$value)=="sd_y"],c(2,ny)))
y_u <- plogis(array(y+1.96*opt$SD$sd[names(opt$SD$value)=="sd_y"],c(2,ny)))
y_l <- plogis(array(y-1.96*opt$SD$sd[names(opt$SD$value)=="sd_y"],c(2,ny)))
matplot(t(y),
type="l", lty=1)
matplot(t(y),
type="l",
ylim=c(0,0.1),
lty=1)
matlines((y_u), lty=2)
y_u
y
qlogis(y)
y <- plogis(array(opt$SD$value[names(opt$SD$value)=="sd_y"],c(2,ny)))
y_u <- plogis(array(qlogis(y)+1.96*opt$SD$sd[names(opt$SD$value)=="sd_y"],c(2,ny)))
y_l <- plogis(array(qlogis(y)-1.96*opt$SD$sd[names(opt$SD$value)=="sd_y"],c(2,ny)))
matplot(t(y),
type="l",
ylim=c(0,0.1),
lty=1)
matlines((y_u), lty=2)
y_u
matlines(t(y_u), lty=2)
matlines(t(y_l), lty=2)
j <- plogis(array(opt$SD$value[names(opt$SD$value)=="sd_j"],c(2,nj)))
j_u <- plogis(array(qlogis(j)+1.96*opt$SD$sd[names(opt$SD$value)=="sd_j"],c(2,nj)))
j_l <- plogis(array(qlogis(j)-1.96*opt$SD$sd[names(opt$SD$value)=="sd_j"],c(2,nj)))
matplot(t(j),
type="l",
ylim=c(0,0.1),
lty=1)
matlines(t(j_u), lty=2)
matlines(t(j_l), lty=2)
j
l <- plogis(array(opt$SD$value[names(opt$SD$value)=="sd_l"],c(2,nl)))
l_u <- plogis(array(qlogis(l)+1.96*opt$SD$sd[names(opt$SD$value)=="sd_l"],c(2,nl)))
l_l <- plogis(array(qlogis(l)-1.96*opt$SD$sd[names(opt$SD$value)=="sd_l"],c(2,nl)))
matplot(t(l),
type="l",
ylim=c(0,0.1),
lty=1)
matlines(t(l_u), lty=2)
matlines(t(l_l), lty=2)
source('C:/NOAA/PROJECTS/bond_survival/plot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/plot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/plot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/plot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/plot_y_j_l_env_effects.r', echo=TRUE)
matplot(l_names,t(l),
type="l",
ylim=c(0,0.06),
lty=1)
matlines(t(l_u), lty=2)
matlines(t(l_l), lty=2)
j <- plogis(array(opt$SD$value[names(opt$SD$value)=="sd_j"],c(2,nj)))
j_u <- plogis(array(qlogis(j)+1.96*opt$SD$sd[names(opt$SD$value)=="sd_j"],c(2,nj)))
j_l <- plogis(array(qlogis(j)-1.96*opt$SD$sd[names(opt$SD$value)=="sd_j"],c(2,nj)))
matplot(j_names,
t(j),
type="l",
ylim=c(0,0.06),
lty=1)
j_names
t(j)
l_names
t(l)
length(l_names)
length(j_names)
sort(unique(round((t_ag$d))))
matplot((1:nl-1)*dBin+min_d,
t(j),
type="l",
ylim=c(0,0.06),
lty=1)
(1:nl-1)*dBin+min_d
matplot((1:nj-1)*dBin+min_d,
t(j),
type="l",
ylim=c(0,0.06),
lty=1)
matlines(j_names,
t(j_u), lty=2)
matplot((1:nj-1)*dBin+min_d,
t(j),
type="l",
ylim=c(0,0.06),
lty=1)
matlines((1:nj-1)*dBin+min_d,
t(j_u), lty=2)
matlines((1:nj-1)*dBin+min_d,
t(j_l), lty=2)
matlines((1:nl-1)*lBin+min_l,
t(l_u), lty=2)
l <- plogis(array(opt$SD$value[names(opt$SD$value)=="sd_l"],c(2,nl)))
l_u <- plogis(array(qlogis(l)+1.96*opt$SD$sd[names(opt$SD$value)=="sd_l"],c(2,nl)))
l_l <- plogis(array(qlogis(l)-1.96*opt$SD$sd[names(opt$SD$value)=="sd_l"],c(2,nl)))
matplot((1:nl-1)*lBin+min_l,
t(l),
type="l",
ylim=c(0,0.06),
lty=1)
matlines((1:nl-1)*lBin+min_l,
t(l_u), lty=2)
matlines((1:nl-1)*lBin+min_l,
t(l_l), lty=2)
t_ag$y
matplot((1:ny-1)*min(t_ag$y),
type="l",
ylim=c(0,0.06),
lty=1)
matplot((1:ny-1)+min(t_ag$y),
type="l",
ylim=c(0,0.06),
lty=1)
(1:ny-1)+min(t_ag$y)
matplot((1:ny-1)+min(t_ag$y),
t(y),
type="l",
ylim=c(0,0.06),
lty=1)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
for(i in c("y")){
m <- opt$SD$value[names(opt$SD$value)==paste0("sd_",i)]
m_sd <- opt$SD$sd[names(opt$SD$value)==paste0("sd_",i)]
if(i=="y"){
df <- data.frame(Migration=rep(c("Unbarged","Barged"),ny),
Year=rep(unique(t_ag$y),2),
m = m,
m_u = m+m_sd*1.96,
m_l = m-m_sd*1.96)
}
}
df
unique(t_ag$y)
rep(sort(unique(t_ag$y)),2)
rep(c("Unbarged","Barged"),ny)
rep(c("Unbarged","Barged"),times=ny)
df <- data.frame(Migration=rep(c("Unbarged","Barged"),each=ny),
Year=rep(sort(unique(t_ag$y)),2),
m = m,
m_u = m+m_sd*1.96,
m_l = m-m_sd*1.96)
df
l_names
nl
df <- df[!is.na(df)]
par(mfcol=c(3,2))
i = 1
df <- data.frame(Effect = NA,
Migration=NA,
Year=NA,
m = NA,
m_u = NA,
m_l = NA)
for(i in c("y")){
m <- opt$SD$value[names(opt$SD$value)==paste0("sd_",i)]
m_sd <- opt$SD$sd[names(opt$SD$value)==paste0("sd_",i)]
if(i=="y"){
df <- cbind(df,
data.frame(Effect = rep("Year",length(unique(t_ag$y))*2),
Migration=rep(c("Unbarged","Barged"),each=ny),
Year=rep(sort(unique(t_ag$y)),2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96)))
}
if(i=="l"){
df <- cbind(df,
data.frame(Effect = rep("Length",nl*2),
Migration=rep(c("Unbarged","Barged"),each=nl),
Year=rep(l_names,2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96)))
}
if(i=="j"){
df <- cbind(df,
data.frame(Effect = rep("Day",nj*2),
Migration=rep(c("Unbarged","Barged"),each=nj),
Year=rep(j_names,2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96)))
}
df <- df[!is.na(df)]
}
df
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
df
df <- data.frame(Effect = NA,
Migration=NA,
Year=NA,
m = NA,
m_u = NA,
m_l = NA)
df
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
df
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
df
df <- #rbind(df,
data.frame(Effect = rep("Year",length(unique(t_ag$y))*2),
Migration=rep(c("Unbarged","Barged"),each=ny),
Year=rep(sort(unique(t_ag$y)),2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96))
df
df <- df[!is.na(df),]
df
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
df
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
df
j_names
nj
max(data$j_i)
unique((min_d:max_d-min_d)/dBin)
unique(round(min_d:max_d-min_d)/dBin))
unique(round((min_d:max_d-min_d)/dBin))
j_names <- unique(round((min_d:max_d-min_d)/dBin))*dBin + min_d
j_names
l_names <- unique(round((min_l:max_l-min_l)/lBin))*lBin + min_l
l_names
length(l_names)
nl
j_names <- unique(round((min_d:max_d-min_d)/dBin))*dBin + min_d
l_names <- unique(round((min_l:max_l-min_l)/lBin))*lBin + min_l
par(mfcol=c(3,2))
i = 1
df <- data.frame(Effect = NA,
Migration=NA,
Year=NA,
m = NA,
m_u = NA,
m_l = NA)
for(i in c("y","l","j")){
m <- opt$SD$value[names(opt$SD$value)==paste0("sd_",i)]
m_sd <- opt$SD$sd[names(opt$SD$value)==paste0("sd_",i)]
if(i=="y"){
df <- rbind(df,
data.frame(Effect = rep("Year",length(unique(t_ag$y))*2),
Migration=rep(c("Unbarged","Barged"),each=ny),
Year=rep(sort(unique(t_ag$y)),2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96)))
}
if(i=="l"){
df <- rbind(df,
data.frame(Effect = rep("Length",nl*2),
Migration=rep(c("Unbarged","Barged"),each=nl),
Year=rep(l_names,2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96)))
}
if(i=="j"){
df <- rbind(df,
data.frame(Effect = rep("Day",nj*2),
Migration=rep(c("Unbarged","Barged"),each=nj),
Year=rep(j_names,2),
m = plogis(m),
m_u = plogis(m+m_sd*1.96),
m_l = plogis(m-m_sd*1.96)))
}
}
df[!is.na(df$m_u),]
library(ggplot2)
p <- ggplot(data=df, aes(x=Year, y = m, factor(Migration))) +
geom_line(size = 0.2,alpha = 0.5, aes(colour=factor(Migration))) +
geom_ribbon(aes(ymin=m_l,
ymax=m_u,
# colour = factor(origin),
fill=factor(origin)),
alpha = 0.15)  +
scale_fill_surv() +
scale_color_surv() +
facet_wrap(~Effect,scales = "free_x") +
# xlim(110,160) +
# ylim(0,0.3) +
theme(panel.background = element_blank()) +
# ylim(0,0.2) +
ylab("Marine survival (ocean entry year)") +
xlab("Calendar day") +
theme(axis.line = element_line(colour = "black", size=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
ggplot2:::manual_scale(
'color',
values = setNames(c('red', 'blue'), c("Unbarged","Barged")),
...
)
scale_color_surv <- function(...){
ggplot2:::manual_scale(
'color',
values = setNames(c('red', 'blue'), c("Unbarged","Barged")),
...
)
}
p <- ggplot(data=df, aes(x=Year, y = m, factor(Migration))) +
geom_line(size = 0.2,alpha = 0.5, aes(colour=factor(Migration))) +
geom_ribbon(aes(ymin=m_l,
ymax=m_u,
# colour = factor(origin),
fill=factor(origin)),
alpha = 0.15)  +
scale_fill_surv() +
scale_color_surv() +
facet_wrap(~Effect,scales = "free_x") +
# xlim(110,160) +
# ylim(0,0.3) +
theme(panel.background = element_blank()) +
# ylim(0,0.2) +
ylab("Marine survival (ocean entry year)") +
xlab("Calendar day") +
theme(axis.line = element_line(colour = "black", size=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
ggplot2:::manual_scale(
'fill',
values = setNames(c('red', 'blue'), c("Unbarged","Barged")),
...
)
scale_fill_surv <- function(...){
ggplot2:::manual_scale(
'fill',
values = setNames(c('red', 'blue'), c("Unbarged","Barged")),
...
)
}
scale_color_surv <- function(...){
ggplot2:::manual_scale(
'color',
values = setNames(c('red', 'blue'), c("Unbarged","Barged")),
...
)
}
p <- ggplot(data=df, aes(x=Year, y = m, factor(Migration))) +
geom_line(size = 0.2,alpha = 0.5, aes(colour=factor(Migration))) +
geom_ribbon(aes(ymin=m_l,
ymax=m_u,
# colour = factor(origin),
fill=factor(origin)),
alpha = 0.15)  +
scale_fill_surv() +
scale_color_surv() +
facet_wrap(~Effect,scales = "free_x") +
# xlim(110,160) +
# ylim(0,0.3) +
theme(panel.background = element_blank()) +
# ylim(0,0.2) +
ylab("Marine survival (ocean entry year)") +
xlab("Calendar day") +
theme(axis.line = element_line(colour = "black", size=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
print(p)
p <- ggplot(data=df, aes(x=Year, y = m, factor(Migration))) +
geom_line(size = 0.2,alpha = 0.5, aes(colour=factor(Migration))) +
geom_ribbon(aes(ymin=m_l,
ymax=m_u,
# colour = factor(Migration),
fill=factor(Migration)),
alpha = 0.15)  +
scale_fill_surv() +
scale_color_surv() +
facet_wrap(~Effect,scales = "free_x") +
# xlim(110,160) +
# ylim(0,0.3) +
theme(panel.background = element_blank()) +
# ylim(0,0.2) +
ylab("Marine survival (ocean entry year)") +
xlab("Calendar day") +
theme(axis.line = element_line(colour = "black", size=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank())
print(p)
matplot(t(rep$eps_j))
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/sar_paper/fig_DayXYearSurvival_ggplot.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/ggplot_y_j_l_env_effects.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
source('C:/NOAA/PROJECTS/bond_survival/tmb_wrapper_MV.r', echo=TRUE)
